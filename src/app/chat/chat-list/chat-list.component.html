<div class="chat-list-container">
  <!-- Searching for users -->
  <div class="search-container">
    <input 
      type="text" 
      [(ngModel)]="searchQuery" 
      (input)="onSearchChange()" 
      placeholder="Search for a user..." 
      aria-label="User Search"
    />
    <ul *ngIf="searchQuery && searchResults.length > 0" class="search-results">
      <li *ngFor="let user of searchResults" 
          class="search-result-item"
          (click)="startChatWithUser(user)" 
          title="Start chat with {{ user.username }}">
        <span class="search-result-username">{{ user.username }}</span>
        
        <button 
          class="view-profile-btn" 
          (click)="onAvatarClick($event, user._id)"
          title="View {{ user.username }}'s profile"
        >
          <span class="profile-icon">ğŸ‘¤</span>
        </button>
      </li>
    </ul>
    <div *ngIf="searchQuery && searchResults.length === 0 && !loading" class="no-search-results">
      No users found for "{{ searchQuery }}"
    </div>

  <!-- Chat list -->
  <div *ngIf="loading" class="loading-indicator">Loading chats..</div>
  <div *ngIf="!loading && chats.length === 0" class="no-chats">No chats.</div>
  <div *ngIf="!loading && chats.length > 0">
    <div *ngFor="let chat of chats" class="chat-item">
      <a (click)="onChatClick(chat._id)" class="chat-link">
        <div class="chat-info">
          <!-- Avatar with profile view option -->
          <div class="chat-avatar" (click)="onAvatarClick($event, getOtherParticipantId(chat))">
            <img 
              [src]="getUserAvatar(chat)" 
              alt="avatar" 
              class="avatar"
              (error)="handleAvatarError($event)"
            />
            <div 
              *ngIf="getOtherParticipantId(chat) && isParticipantOnline(getOtherParticipantId(chat)!)" 
              class="online-indicator"
            ></div>
          </div>
          <!-- Details -->
          <div class="chat-details">
            <span class="chat-participants">
              <span 
                class="participant-name"
                (click)="onParticipantNameClick($event, getOtherParticipantId(chat))"
              >
                {{ chat.participantsString }}
              </span>
              <span 
                *ngIf="getOtherParticipantId(chat) && isParticipantOnline(getOtherParticipantId(chat)!)" 
                class="online-text"
              >
                â€¢ online
              </span>  
            </span>
            <span class="chat-preview">
              {{ chat.lastMessage ? chat.lastMessage.content : 'No messages' }}
            </span>
          </div>
        </div>
      </a>
    </div>
  </div>
</div>